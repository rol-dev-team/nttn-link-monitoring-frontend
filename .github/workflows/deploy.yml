name: Vite React App CI/CD on Push to develop

on:
  push:
    branches:
      - develop

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest 

    steps:
    
    - name: 1. Checkout Repository Code
      uses: actions/checkout@v4 

    - name: 2. Setup Node.js Environment
      uses: actions/setup-node@v4
      with:
        node-version: '22' 
        cache: 'npm'       

    - name: 3. Install Project Dependencies
      run: npm install


    - name: 5. Build Vite React App
      run: npm run build


    - name: 6. Deploy 'dist' folder to Server via SSH 
      uses: appleboy/ssh-action@v1.0.3

      with:
        host: ${{ secrets.SERVER_HOST }}
        username: ${{ secrets.SERVER_USER }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        
        source: "dist" 
        target: "/var/www/html/nttn-monitoring-application/frontend"
        
        script: |
          echo "Successfully deployed to /var/www/html/nttn-monitoring-application/frontend"
          sudo systemctl reload nginx
